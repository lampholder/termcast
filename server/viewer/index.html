<!doctype html>
<html>
    <head>
        <title>Termcast terminal viewer.</title>
        <link type="text/css" rel="stylesheet" href="xterm.css" />
        <script type="text/javascript" src="xterm.js"></script>
        <script type="text/javascript">
            var sessionId = window.location.pathname.substr(1).slice(0, -1);
            var host = 'ws://localhost/' + sessionId; // wss://termcast.me
            document.addEventListener("DOMContentLoaded", function(event) {
                var term = new Terminal();
                term.open(document.getElementById('terminal'));

                var ws = new WebSocket(host);

                ws.onopen = function(event) {
                    ws.send(JSON.stringify({'type': 'registerSubscriber',
                                            'msg': ''}));
                };

                ws.onmessage = function (event) {
                    var packet = JSON.parse(event.data);
                    switch(packet.type) {
                        case 'status':
                            console.log(packet.msg);
                            break;
                        case 'stream':
                            term.write(packet.msg);
                            break;
                        case 'viewcount':
                            break;
                    }
                };
            });
        </script>
    </head>
    <body>
        <div id="terminal"></div>
    </body>
</html>
